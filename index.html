<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>XRISK Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin:0; padding:0; background:#001429; }
        header { background:#000000; color:white; padding:15px 30px; display:flex; align-items:center; justify-content:space-between; }
        header nav a { color:white; margin:0 15px; text-decoration:none; font-weight:bold; }
        .hero { background:#ffffff; padding:50px 30px; text-align:center; }
        .hero h1 { font-size:32px; margin-bottom:15px; }
        .hero p { font-size:18px; color:#444; margin-bottom:20px; }
        .btn { background:#0078d4; color:white; padding:12px 25px; text-decoration:none; border-radius:5px; font-weight:bold; display:inline-block; cursor:pointer; border:none; font-size:14px; transition: background 0.3s; }
        .btn:hover { background:#005a9e; }
        .section { padding:40px 30px; background:#ffffff; margin-top:20px; border-radius:8px; max-width:1100px; margin-left:auto; margin-right:auto; position:relative; }
        .section h2 { font-size:28px; color:#0b2c3d; margin-bottom:10px; }
        .section p { font-size:16px; color:#555; line-height:1.5; }
        
        /* Bot√≥n de captura */
        .capture-btn {
            position: absolute;
            top: 10px;
            right: 30px;
            background: #dc3545;
            padding: 8px 16px;
            font-size: 14px;
            z-index: 100;
        }
        .capture-btn:hover {
            background: #c82333;
        }
        
        /* Estilos para el dashboard */
        .dashboard-container {
            background:#D9D9D9;
            padding:20px;
            border-radius:10px;
            position: relative;
            margin-top: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* ===== ESTILO PARA OCULTAR BARRA POWER BI ===== */
        .pbi-wrapper {
            width: 100%;
            height: 560px;
            overflow: hidden;
            position: relative;
            border-radius: 8px;
        }

        .pbi-wrapper iframe {
            width: 100%;
            height: 700px;
            border: none;
        }
        
        /* Overlay de captura */
        .capture-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 20, 41, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .capture-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            text-align: center;
            box-shadow: 0 5px 25px rgba(0,0,0,0.3);
        }
        
        .capture-box h3 {
            color: #001429;
            margin-bottom: 20px;
            font-size: 22px;
        }
        
        /* Marco de selecci√≥n */
        .selection-frame {
            position: absolute;
            border: 2px dashed #dc3545;
            background: rgba(220, 53, 69, 0.1);
            z-index: 9998;
            pointer-events: none;
            display: none;
        }
        
        /* Bot√≥n dentro del iframe */
        .capture-trigger {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            z-index: 1000;
        }
    </style>
</head>
<body>

<!-- ===== CABECERA / MENU ===== -->
<header>
    <div class="logo">
        <span style="font-size:24px; font-weight:bold;">XRISK Demo</span>
    </div>
    <nav>
        <a href="#dashboard1">DASHBOARD 1</a>
        <a href="#dashboard2">DASHBOARD 2 (sin barra)</a>
        <a href="#soluciones">SOLUCIONES</a>
        <a href="#contacto">CONTACTO</a>
    </nav>
</header>

<!-- ===== HERO / TITULO PRINCIPAL ===== -->
<section class="hero">
    <h1>Lleva tu empresa al siguiente nivel</h1>
    <p>Somos una firma especializada en soluciones estrat√©gicas, inteligencia artificial y an√°lisis de datos.</p>
</section>

<!-- ===== DASHBOARD 1 (ORIGINAL CON BARRA) ===== -->
<section id="dashboard1" class="section">
    <h2>Dashboard con barra inferior (original)</h2>
    
    <!-- Bot√≥n para capturar el dashboard -->
    <button id="captureDashboard1" class="btn capture-btn">
        üì∏ Capturar Dashboard
    </button>
    
    <div class="dashboard-container" id="dashboard1-container">
        <!-- Dashboard de Power BI -->
        <iframe 
            src="https://app.powerbi.com/view?r=eyJrIjoiNDBmZDUzN2QtNWU4Yy00Y2QzLTg0NDctMjMxNjRkYzZiMDdjIiwidCI6IjFlYmE0NDNmLTIzZTUtNDUzNC05MGQxLTA5NzZhYWJlODZhYyIsImMiOjR9" 
            style="width:100%; height:560px; border:none; border-radius:8px;" 
            allowfullscreen="true"
            id="dashboardIframe">
        </iframe>
    </div>
    
    <!-- Mensaje de estado -->
    <div id="captureStatus" style="text-align:center; margin-top:15px; padding:10px; border-radius:5px; display:none;"></div>
</section>

<!-- ===== DASHBOARD 2 (FORMA 1 ‚Äì SIN BARRA INFERIOR) ===== -->
<section id="dashboard2" class="section">
    <h2>Dashboard sin barra inferior (Forma 1)</h2>
    <div style="background:#D9D9D9; padding:20px; border-radius:10px;">
        <div class="pbi-wrapper">
            <iframe 
                src="https://app.powerbi.com/view?r=eyJrIjoiNDBmZDUzN2QtNWU4Yy00Y2QzLTg0NDctMjMxNjRkYzZiMDdjIiwidCI6IjFlYmE0NDNmLTIzZTUtNDUzNC05MGQxLTA5NzZhYWJlODZhYyIsImMiOjR9"
                allowfullscreen="true">
            </iframe>
        </div>
    </div>
</section>

<!-- ===== CONTACTO ===== -->
<section id="contacto" class="section">
    <h2>Contacto</h2>
    <p>Correo: cclaros@xrisk.pe</p>
    <p>Tel: +51 994 366 233</p>
</section>

<!-- Overlay de captura -->
<div id="captureOverlay" class="capture-overlay">
    <div class="capture-box">
        <h3>üì∏ Seleccionar √Årea para Capturar</h3>
        <p>Arrastra el cursor para seleccionar el √°rea del dashboard que deseas capturar</p>
        <p><small>Haz clic y arrastra sobre el dashboard para definir el √°rea de captura</small></p>
        <div id="captureInstructions" style="margin:20px 0; padding:15px; background:#f8f9fa; border-radius:5px; text-align:left;">
            <p><strong>Instrucciones:</strong></p>
            <ol style="margin:10px 0; padding-left:20px;">
                <li>Haz clic en el dashboard y mant√©n presionado</li>
                <li>Arrastra para seleccionar el √°rea deseada</li>
                <li>Suelta el bot√≥n del mouse para capturar</li>
            </ol>
        </div>
        <button id="startCapture" class="btn" style="background:#28a745;">Comenzar Captura</button>
        <button id="cancelCapture" class="btn" style="background:#6c757d; margin-left:10px;">Cancelar</button>
    </div>
</div>

<!-- Marco de selecci√≥n -->
<div id="selectionFrame" class="selection-frame"></div>

<script>
    // Variables globales
    let isCapturing = false;
    let startX, startY, currentX, currentY;
    
    // Elementos del DOM
    const captureBtn = document.getElementById('captureDashboard1');
    const overlay = document.getElementById('captureOverlay');
    const startCaptureBtn = document.getElementById('startCapture');
    const cancelBtn = document.getElementById('cancelCapture');
    const selectionFrame = document.getElementById('selectionFrame');
    const statusDiv = document.getElementById('captureStatus');
    const dashboardContainer = document.getElementById('dashboard1-container');
    const iframe = document.getElementById('dashboardIframe');
    
    // Mostrar overlay de captura
    captureBtn.addEventListener('click', function() {
        overlay.style.display = 'flex';
        statusDiv.style.display = 'none';
    });
    
    // Iniciar captura
    startCaptureBtn.addEventListener('click', function() {
        overlay.style.display = 'none';
        isCapturing = true;
        selectionFrame.style.display = 'block';
        
        // Asegurar que el dashboard est√© visible
        dashboardContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // Mostrar instrucciones
        statusDiv.innerHTML = 'üñ±Ô∏è <strong>Haz clic y arrastra sobre el dashboard para seleccionar el √°rea</strong>';
        statusDiv.style.display = 'block';
        statusDiv.style.backgroundColor = '#fff3cd';
        statusDiv.style.color = '#856404';
        statusDiv.style.border = '1px solid #ffeaa7';
    });
    
    // Cancelar captura
    cancelBtn.addEventListener('click', function() {
        overlay.style.display = 'none';
        resetCapture();
    });
    
    // Funci√≥n para resetear captura
    function resetCapture() {
        isCapturing = false;
        selectionFrame.style.display = 'none';
        statusDiv.style.display = 'none';
    }
    
    // Iniciar selecci√≥n
    document.addEventListener('mousedown', function(e) {
        if (!isCapturing) return;
        
        // Verificar si el clic fue dentro del dashboard
        const containerRect = dashboardContainer.getBoundingClientRect();
        if (e.clientX < containerRect.left || 
            e.clientX > containerRect.right || 
            e.clientY < containerRect.top || 
            e.clientY > containerRect.bottom) {
            return;
        }
        
        e.preventDefault();
        startX = e.clientX;
        startY = e.clientY;
        
        selectionFrame.style.left = startX + 'px';
        selectionFrame.style.top = startY + 'px';
        selectionFrame.style.width = '0px';
        selectionFrame.style.height = '0px';
        
        // Agregar listeners para arrastrar y soltar
        document.addEventListener('mousemove', mouseMoveHandler);
        document.addEventListener('mouseup', mouseUpHandler);
    });
    
    // Manejar movimiento del mouse durante selecci√≥n
    function mouseMoveHandler(e) {
        currentX = e.clientX;
        currentY = e.clientY;
        
        const width = Math.abs(currentX - startX);
        const height = Math.abs(currentY - startY);
        const left = Math.min(startX, currentX);
        const top = Math.min(startY, currentY);
        
        selectionFrame.style.left = left + 'px';
        selectionFrame.style.top = top + 'px';
        selectionFrame.style.width = width + 'px';
        selectionFrame.style.height = height + 'px';
    }
    
    // Manejar fin de selecci√≥n
    async function mouseUpHandler(e) {
        document.removeEventListener('mousemove', mouseMoveHandler);
        document.removeEventListener('mouseup', mouseUpHandler);
        
        const width = Math.abs(currentX - startX);
        const height = Math.abs(currentY - startY);
        
        // Validar tama√±o m√≠nimo
        if (width < 50 || height < 50) {
            statusDiv.innerHTML = '‚ö†Ô∏è <strong>Selecci√≥n muy peque√±a. Por favor, selecciona un √°rea m√°s grande.</strong>';
            statusDiv.style.backgroundColor = '#f8d7da';
            statusDiv.style.color = '#721c24';
            statusDiv.style.border = '1px solid #f5c6cb';
            selectionFrame.style.display = 'none';
            return;
        }
        
        // Capturar pantalla
        await captureScreenArea(
            Math.min(startX, currentX),
            Math.min(startY, currentY),
            width,
            height
        );
        
        resetCapture();
    }
    
    // Funci√≥n principal de captura usando API del navegador
    async function captureScreenArea(x, y, width, height) {
        try {
            statusDiv.innerHTML = '‚è≥ <strong>Capturando pantalla...</strong>';
            statusDiv.style.backgroundColor = '#d1ecf1';
            statusDiv.style.color = '#0c5460';
            statusDiv.style.border = '1px solid #bee5eb';
            
            // Intentar usar la API de captura de pantalla
            const stream = await navigator.mediaDevices.getDisplayMedia({
                video: {
                    displaySurface: 'browser'  // Capturar solo la pesta√±a del navegador
                },
                audio: false,
                preferCurrentTab: true  // Preferir capturar la pesta√±a actual
            });
            
            // Crear video para capturar el frame
            const video = document.createElement('video');
            video.style.position = 'fixed';
            video.style.top = '-10000px';
            video.style.left = '-10000px';
            document.body.appendChild(video);
            
            video.srcObject = stream;
            await video.play();
            
            // Esperar a que el video est√© listo
            await new Promise(resolve => {
                video.onloadeddata = resolve;
            });
            
            // Crear canvas temporal
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Ajustar tama√±o del canvas al √°rea seleccionada
            canvas.width = width;
            canvas.height = height;
            
            // Capturar el frame del video
            ctx.drawImage(video, x, y, width, height, 0, 0, width, height);
            
            // Detener el stream
            stream.getTracks().forEach(track => track.stop());
            
            // Remover el video
            document.body.removeChild(video);
            
            // Crear imagen a partir del canvas
            const imageData = canvas.toDataURL('image/png');
            
            // Descargar la imagen
            downloadImage(imageData, width, height);
            
        } catch (error) {
            console.error('Error en captura:', error);
            
            // M√©todo alternativo: Usar canvas para capturar elementos visibles
            try {
                statusDiv.innerHTML = 'üé® <strong>Usando m√©todo alternativo de captura...</strong>';
                
                // Capturar toda la ventana con un canvas
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = window.innerWidth;
                tempCanvas.height = document.body.scrollHeight;
                const tempCtx = tempCanvas.getContext('2d');
                
                // Crear una imagen de la p√°gina (solo elementos HTML, no iframes)
                const htmlCapture = await htmlToCanvas();
                if (htmlCapture) {
                    tempCtx.drawImage(htmlCapture, 0, 0);
                    
                    // Crear canvas final con el √°rea seleccionada
                    const finalCanvas = document.createElement('canvas');
                    finalCanvas.width = width;
                    finalCanvas.height = height;
                    const finalCtx = finalCanvas.getContext('2d');
                    
                    // Extraer el √°rea seleccionada
                    finalCtx.drawImage(
                        tempCanvas,
                        x, y, width, height,
                        0, 0, width, height
                    );
                    
                    // Descargar
                    const imageData = finalCanvas.toDataURL('image/png');
                    downloadImage(imageData, width, height);
                } else {
                    throw new Error('No se pudo capturar la pantalla');
                }
                
            } catch (altError) {
                console.error('Error en m√©todo alternativo:', altError);
                
                // M√©todo de respaldo: crear una imagen simple del √°rea seleccionada
                createManualCapture(x, y, width, height);
            }
        }
    }
    
    // Funci√≥n para convertir HTML a Canvas (m√©todo alternativo)
    function htmlToCanvas() {
        return new Promise((resolve, reject) => {
            // Crear un canvas con el contenido visible
            const canvas = document.createElement('canvas');
            canvas.width = window.innerWidth;
            canvas.height = document.body.scrollHeight;
            const ctx = canvas.getContext('2d');
            
            // Establecer fondo blanco
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Para el dashboard, dibujar un marcador de posici√≥n
            const dashboardRect = dashboardContainer.getBoundingClientRect();
            
            // Fondo del dashboard
            ctx.fillStyle = '#D9D9D9';
            ctx.fillRect(dashboardRect.left, dashboardRect.top + window.scrollY, 
                        dashboardRect.width, dashboardRect.height);
            
            // Marco del dashboard
            ctx.strokeStyle = '#cccccc';
            ctx.lineWidth = 1;
            ctx.strokeRect(dashboardRect.left, dashboardRect.top + window.scrollY, 
                         dashboardRect.width, dashboardRect.height);
            
            // Texto indicativo
            ctx.fillStyle = '#666666';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Dashboard de Power BI (contenido din√°mico)', 
                        dashboardRect.left + dashboardRect.width/2, 
                        dashboardRect.top + window.scrollY + dashboardRect.height/2);
            
            resolve(canvas);
        });
    }
    
    // M√©todo manual como √∫ltimo recurso
    function createManualCapture(x, y, width, height) {
        const canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');
        
        // Fondo blanco
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, width, height);
        
        // Borde
        ctx.strokeStyle = '#0078d4';
        ctx.lineWidth = 2;
        ctx.strokeRect(1, 1, width-2, height-2);
        
        // Texto informativo
        ctx.fillStyle = '#333333';
        ctx.font = '14px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Dashboard capturado manualmente', width/2, height/2 - 20);
        ctx.fillText('Fecha: ' + new Date().toLocaleString(), width/2, height/2 + 10);
        ctx.fillText('√Årea: ' + width + 'x' + height + 'px', width/2, height/2 + 40);
        
        // Descargar
        const imageData = canvas.toDataURL('image/png');
        downloadImage(imageData, width, height);
        
        statusDiv.innerHTML = '‚ÑπÔ∏è <strong>Se cre√≥ una captura manual. Para mejores resultados usa las herramientas del sistema.</strong>';
        statusDiv.style.backgroundColor = '#e2e3e5';
        statusDiv.style.color = '#383d41';
        statusDiv.style.border = '1px solid #d6d8db';
    }
    
    // Funci√≥n para descargar la imagen
    function downloadImage(imageData, width, height) {
        const link = document.createElement('a');
        const timestamp = new Date().getTime();
        const filename = `xrisk-dashboard-${timestamp}-${width}x${height}.png`;
        
        link.download = filename;
        link.href = imageData;
        link.click();
        
        // Mostrar confirmaci√≥n
        statusDiv.innerHTML = `‚úÖ <strong>¬°Captura completada!</strong><br>
                              <small>Imagen descargada: ${filename}</small>`;
        statusDiv.style.backgroundColor = '#d4edda';
        statusDiv.style.color = '#155724';
        statusDiv.style.border = '1px solid #c3e6cb';
        statusDiv.style.display = 'block';
        
        // Ocultar despu√©s de 5 segundos
        setTimeout(() => {
            statusDiv.style.display = 'none';
        }, 5000);
    }
    
    // Atajo de teclado para capturar
    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey && e.key === 'p') || (e.ctrlKey && e.key === 'P')) {
            e.preventDefault();
            captureBtn.click();
        }
    });
</script>

</body>
</html>

