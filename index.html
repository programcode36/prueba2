<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>XRISK Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin:0; padding:0; background:#001429; }
        header { background:#000000; color:white; padding:15px 30px; display:flex; align-items:center; justify-content:space-between; }
        header nav a { color:white; margin:0 15px; text-decoration:none; font-weight:bold; }
        .hero { background:#ffffff; padding:50px 30px; text-align:center; }
        .hero h1 { font-size:32px; margin-bottom:15px; }
        .hero p { font-size:18px; color:#444; margin-bottom:20px; }
        .btn { background:#0078d4; color:white; padding:12px 25px; text-decoration:none; border-radius:5px; font-weight:bold; display:inline-block; cursor:pointer; border:none; font-size:14px; }
        .btn:hover { background:#005a9e; }
        .section { padding:40px 30px; background:#ffffff; margin-top:20px; border-radius:8px; max-width:1100px; margin-left:auto; margin-right:auto; position:relative; }
        .section h2 { font-size:28px; color:#0b2c3d; margin-bottom:10px; }
        .section p { font-size:16px; color:#555; line-height:1.5; }
        
        /* Bot√≥n de captura */
        .capture-btn {
            position: absolute;
            top: 10px;
            right: 30px;
            background: #28a745;
            padding: 8px 16px;
            font-size: 14px;
            z-index: 100;
        }
        .capture-btn:hover {
            background: #218838;
        }
        
        /* Estilos para el dashboard */
        .dashboard-container {
            background:#D9D9D9;
            padding:20px;
            border-radius:10px;
            position: relative;
            margin-top: 40px;
        }

        /* ===== ESTILO PARA OCULTAR BARRA POWER BI ===== */
        .pbi-wrapper {
            width: 100%;
            height: 560px;
            overflow: hidden;
            position: relative;
            border-radius: 8px;
        }

        .pbi-wrapper iframe {
            width: 100%;
            height: 700px;
            border: none;
        }
        
        /* Mensaje de captura */
        .capture-message {
            text-align: center;
            margin-top: 15px;
            color: #28a745;
            font-weight: bold;
            display: none;
            padding: 10px;
            background-color: #f0fff4;
            border-radius: 5px;
            border: 1px solid #c3e6cb;
        }
        
        /* Overlay durante la captura */
        .capture-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            display: none;
        }
        
        .capture-frame {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
        }
        
        .close-preview {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
    <!-- Incluir html2canvas -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>

<!-- ===== CABECERA / MENU ===== -->
<header>
    <div class="logo">
        <span style="font-size:24px; font-weight:bold;">XRISK Demo</span>
    </div>
    <nav>
        <a href="#dashboard1">DASHBOARD 1</a>
        <a href="#dashboard2">DASHBOARD 2 (sin barra)</a>
        <a href="#soluciones">SOLUCIONES</a>
        <a href="#contacto">CONTACTO</a>
    </nav>
</header>

<!-- ===== HERO / TITULO PRINCIPAL ===== -->
<section class="hero">
    <h1>Lleva tu empresa al siguiente nivel</h1>
    <p>Somos una firma especializada en soluciones estrat√©gicas, inteligencia artificial y an√°lisis de datos.</p>
</section>

<!-- ===== DASHBOARD 1 (ORIGINAL CON BARRA) ===== -->
<section id="dashboard1" class="section">
    <h2>Dashboard con barra inferior (original)</h2>
    
    <!-- Bot√≥n para capturar el dashboard -->
    <button id="captureDashboard1" class="btn capture-btn">
        üì∏ Capturar Dashboard
    </button>
    
    <div class="dashboard-container" id="dashboard1-container">
        <!-- Dashboard de Power BI -->
        <iframe 
            src="https://app.powerbi.com/view?r=eyJrIjoiNDBmZDUzN2QtNWU4Yy00Y2QzLTg0NDctMjMxNjRkYzZiMDdjIiwidCI6IjFlYmE0NDNmLTIzZTUtNDUzNC05MGQxLTA5NzZhYWJlODZhYyIsImMiOjR9" 
            style="width:100%; height:560px; border:none; border-radius:8px;" 
            allowfullscreen="true">
        </iframe>
    </div>
    
    <!-- Mensaje de confirmaci√≥n -->
    <div id="captureMessage" class="capture-message">
        ¬°Captura realizada! La imagen se ha descargado autom√°ticamente.
    </div>
</section>

<!-- ===== DASHBOARD 2 (FORMA 1 ‚Äì SIN BARRA INFERIOR) ===== -->
<section id="dashboard2" class="section">
    <h2>Dashboard sin barra inferior (Forma 1)</h2>
    <div style="background:#D9D9D9; padding:20px; border-radius:10px;">
        <div class="pbi-wrapper">
            <iframe 
                src="https://app.powerbi.com/view?r=eyJrIjoiNDBmZDUzN2QtNWU4Yy00Y2QzLTg0NDctMjMxNjRkYzZiMDdjIiwidCI6IjFlYmE0NDNmLTIzZTUtNDUzNC05MGQxLTA5NzZhYWJlODZhYyIsImMiOjR9"
                allowfullscreen="true">
            </iframe>
        </div>
    </div>
</section>

<!-- ===== CONTACTO ===== -->
<section id="contacto" class="section">
    <h2>Contacto</h2>
    <p>Correo: cclaros@xrisk.pe</p>
    <p>Tel: +51 994 366 233</p>
</section>

<!-- Overlay para previsualizaci√≥n -->
<div id="captureOverlay" class="capture-overlay">
    <div class="capture-frame">
        <button id="closePreview" class="close-preview">√ó</button>
        <h3 style="margin-top: 0;">Vista previa de la captura</h3>
        <img id="previewImage" src="" style="max-width: 100%; border: 1px solid #ddd;">
        <div style="margin-top: 15px; text-align: center;">
            <button id="downloadCapture" class="btn" style="background: #28a745;">Descargar Imagen</button>
        </div>
    </div>
</div>

<script>
    // Funci√≥n para capturar el √°rea visible del dashboard
    document.getElementById('captureDashboard1').addEventListener('click', function() {
        const container = document.getElementById('dashboard1-container');
        const message = document.getElementById('captureMessage');
        const overlay = document.getElementById('captureOverlay');
        const previewImage = document.getElementById('previewImage');
        
        // Ocultar mensaje anterior si existe
        message.style.display = 'none';
        
        // Desplazar la p√°gina para asegurar que el dashboard est√© completamente visible
        container.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // Esperar un momento para que termine la animaci√≥n de scroll
        setTimeout(() => {
            // Obtener las coordenadas del contenedor
            const rect = container.getBoundingClientRect();
            
            // Calcular las dimensiones de la captura
            const captureWidth = rect.width;
            const captureHeight = rect.height;
            const captureX = rect.left + window.scrollX;
            const captureY = rect.top + window.scrollY;
            
            // Usar html2canvas para capturar el √°rea espec√≠fica
            html2canvas(document.body, {
                x: captureX,
                y: captureY,
                width: captureWidth,
                height: captureHeight,
                backgroundColor: '#D9D9D9',
                scale: 1,
                useCORS: true,
                logging: false,
                windowWidth: document.documentElement.scrollWidth,
                windowHeight: document.documentElement.scrollHeight
            }).then(canvas => {
                // Crear un enlace para descargar la imagen
                const link = document.createElement('a');
                const timestamp = new Date().getTime();
                link.download = `dashboard-xrisk-${timestamp}.png`;
                link.href = canvas.toDataURL('image/png');
                
                // Mostrar vista previa
                previewImage.src = link.href;
                overlay.style.display = 'flex';
                
                // Configurar bot√≥n de descarga
                document.getElementById('downloadCapture').onclick = function() {
                    link.click();
                    overlay.style.display = 'none';
                    message.style.display = 'block';
                    
                    // Ocultar mensaje despu√©s de 3 segundos
                    setTimeout(() => {
                        message.style.display = 'none';
                    }, 3000);
                };
                
            }).catch(error => {
                console.error('Error al capturar el dashboard:', error);
                
                // M√©todo alternativo: capturar toda la pantalla y luego recortar
                alert('Capturando pantalla completa...');
                
                html2canvas(document.body, {
                    backgroundColor: '#001429',
                    scale: 1,
                    useCORS: true,
                    logging: false
                }).then(fullCanvas => {
                    // Crear un canvas para el √°rea del dashboard
                    const dashboardCanvas = document.createElement('canvas');
                    dashboardCanvas.width = rect.width;
                    dashboardCanvas.height = rect.height;
                    const ctx = dashboardCanvas.getContext('2d');
                    
                    // Dibujar solo el √°rea del dashboard
                    ctx.drawImage(fullCanvas, 
                        captureX, captureY, captureWidth, captureHeight, // √Årea fuente
                        0, 0, captureWidth, captureHeight // √Årea destino
                    );
                    
                    // Crear enlace para descargar
                    const link = document.createElement('a');
                    const timestamp = new Date().getTime();
                    link.download = `dashboard-xrisk-${timestamp}.png`;
                    link.href = dashboardCanvas.toDataURL('image/png');
                    
                    // Mostrar vista previa
                    previewImage.src = link.href;
                    overlay.style.display = 'flex';
                    
                    // Configurar bot√≥n de descarga
                    document.getElementById('downloadCapture').onclick = function() {
                        link.click();
                        overlay.style.display = 'none';
                        message.style.display = 'block';
                        
                        // Ocultar mensaje despu√©s de 3 segundos
                        setTimeout(() => {
                            message.style.display = 'none';
                        }, 3000);
                    };
                });
            });
        }, 500);
    });
    
    // Cerrar la vista previa
    document.getElementById('closePreview').addEventListener('click', function() {
        document.getElementById('captureOverlay').style.display = 'none';
    });
    
    // Cerrar la vista previa al hacer clic fuera de ella
    document.getElementById('captureOverlay').addEventListener('click', function(e) {
        if (e.target === this) {
            this.style.display = 'none';
        }
    });
    
    // Atajo de teclado para capturar (P)
    document.addEventListener('keydown', function(event) {
        if ((event.key === 'p' || event.key === 'P') && event.ctrlKey) {
            event.preventDefault();
            document.getElementById('captureDashboard1').click();
        }
    });
    
    // Tambi√©n agregar atajo sin Ctrl cuando el dashboard est√° visible
    document.addEventListener('keydown', function(event) {
        const dashboard1Section = document.getElementById('dashboard1');
        const rect = dashboard1Section.getBoundingClientRect();
        const isInDashboardSection = rect.top < window.innerHeight && rect.bottom > 0;
        
        if (isInDashboardSection && (event.key === 'p' || event.key === 'P') && !event.ctrlKey) {
            event.preventDefault();
            document.getElementById('captureDashboard1').click();
        }
    });
</script>

</body>
</html>
